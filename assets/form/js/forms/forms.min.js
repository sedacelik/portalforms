//#Copyright (c) 2016-2017 Rafal Marguzewicz pceuropa.net
"use strict";var MyFORM=MyFORM||{};MyFORM=function(){var b="1.0",c=function(){this.title="FormBuilder",this.action="",this.method="post",this.language="English",this.body=[],this.get(),console.log("constructor"),this.render()};return c.prototype={constructor:c,viewMode:"html",map:{index:"0",row:"0"},config:{get:!0,save:!0,autosave:!1},clear:function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},filter:function(a){var b={};for(var c in a)if(a[c])if(Array.isArray(a[c])){b[c]=[];for(var d=a[c].length;d--;)b[c][d]=a[c][d];a[c]=[]}else"view"!==c&&(b[c]=a[c]);return b},get:function(){var a=this;this.config.get&&$.getJSON(document.URL,function(b){console.log("upload from base correct"),a.generate(b)})},generate:function(a){this.title=a.title||"",this.action=a.action||"",this.method=a.method||"",this.id=a.id||"",this.body.class=a.class||"",this.body=a.body||{},this.body.length>0&&this.render()},rows:function(){var a="";if(0==this.body.length)return a;for(var b=0,c=this.body.length;b<c;b+=1)a+=this.row(b);return a},row:function(a){return'\n<div id="row'+a+'" class="row">\n'+this.fields(a)+" \n</div>\n"},fields:function(a){for(var b="",c=0,d=this.body[a].length;c<d;c++)b+=this.field(a,c);return b},field:function(a,b){var c=this.body[a][b],d=new MyFORM.field.factory(c);return d.html()},render:function(){var a=$("#preview-form");switch(console.log("text"),c.prototype.viewMode){case"text":a.html("<pre><code> </code></pre>").find("code").text(this.view("html"));break;case"json":a.html("<pre><code> </code></pre>").find("code").text(this.view("json"));break;case"yii2":a.html("<pre><code> </code></pre>").find("code").text("Yii2");break;default:a.html(this.view("html"))}},view:function(a){switch(a){case"html":return'<form  action="'+this.action+'" method="'+this.method+'" '+this.attr("id","class")+">"+this.rows()+"\n</form>";case"json":return JSON.stringify(this,null,4);case"h1":return this.title}},setView:function(a){c.prototype.viewMode=a||""}},{version:b,Form:c}}();var MyFORM=MyFORM||{};MyFORM.field=function(){var a=function(a){this.body=a||{},this.init()};a.prototype={constructor:a,view:!0,init:function(){this.set(MyFORM.field[this.body.field])},uiHelper:function(){var a=this;!function(){for(var c=document.getElementById(a.body.field).getElementsByClassName("data-source"),d=0;d<c.length;d++)a.body[c[d].id]="checkbox"===c[d].type?c[d].checked:c[d].value}(),function(){""==$("#"+a.body.field+" #name").val()&&($(this).css("color","red"),$(this).val(a.body.field))}()},set:function(a){a=a||{};for(var b in a)this[b]=a[b]},addItem:function(){try{for(var a=document.getElementById(this.body.field).getElementsByClassName("itemField"),b={},c=0;c<a.length;c++)b[a[c].id]="checkbox"===a[c].type?a[c].checked:a[c].value;this.body.items.push(b),this.render()}catch(a){console.log(a),alert("Error add item to field: bad id of div")}},render:function(){var a=$("#preview-field"),b=this;this.view?a.html("<p>Preview field: (<a>html</a>) </p>"+b.html()):a.html("<p>Preview field: (<a>text</a>)</p><pre><code> </code></pre></p>").find("code").text(b.html()),a.find("a").click(function(){b.view=!b.view,b.render()})},renderUpdateItemField:function(){var a=this;this.body.hasOwnProperty("items")&&this.body.items.length&&$("#"+a.body.field+" .select-item-to-change").html(function(){var b=0,c="",d="";for(b;b<a.body.items.length;b++)c=a.body.items[b].text?a.body.items[b].text:"",d+='<option value="'+b+'">'+(b+1)+". "+c+"</option>";return'<select class="change-item form-control input-sm"> <option selected>Change item</option>'+d+"</select>"}())},is:function(a){return a?a:""},typeAttr:function(){return this.body.type?' type="'+this.body.type+'"':""},labelAttr:function(){var a="";return this.body.require&&(a=" *"),this.body.label?"\n\t<label>"+this.body.label+a+"</label>":""},nameAttr:function(a){var a=a||!1;return a?this.body.name?' name="'+this.body.name+'[]"':"":this.body.name?' name="'+this.body.name+'"':""},valueAttr:function(){return this.body.value?' value="'+this.body.value+'"':" "},placeholderAttr:function(){return this.body.placeholder?' placeholder="'+this.body.placeholder+'"':""},idAttr:function(){return this.body.id?' id="'+this.body.id+'"':""},classAttr:function(){return this.body.class?' class="form-control '+this.body.class+'"':' class="form-control"'},dataAttr:function(){return this.body.data?' data="'+this.body.data+'"':""},rowsAttr:function(){return this.body.rows?' rows="'+this.body.rows+'"':""},checkedAttr:function(){return this.body.checked?" checked":""},requireAttr:function(){return this.body.require?" required":""},checkedAttr:function(){return this.body.require?" checked":""},helpBlockAttr:function(){return this.body.helpBlock?'\n\t<span class="help-block">'+this.body.helpBlock+"</span>":""},div:function(){return'<div class="form-group '+this.body.width+'">'},divEnd:function(){return"\n</div>"},attr:function(){for(var a,b="",c=arguments.length,a=0;a<c;a+=1)b+=this[arguments[a]+"Attr"]();return b},el:function(a){for(var b,d,c="",e=arguments.length,b=1;b<e;b+=1)d=arguments[b]+"El",c+=this[d](a);return c},labelEl:function(a){var b=this.body.items[a].text;return b?b:""},valueEl:function(a){var b=this.body.items[a].value;return b?' value="'+b+'"':' value="'+a+'"'},idEl:function(a){var b=this.body.items[a].id;return b?' id="'+b+'"':""},classEl:function(a){var b=this.body.items[a].class;return b?' class="'+b+'"':""},checkedEl:function(a){return this.body.items[a].checked?" checked":""},selectedEl:function(a){return this.body.items[a].checked?" selected":""},requireEl:function(){return this.require?" required":""},inputs:function(){var a=0,b="";for("undefined"==typeof this.body.items&&(this.body.items=[]),a;a<this.body.items.length;a++)b+=this.input(a);return b},inputHtml:function(a,b){return'<input type="'+this.is(a)+'"'+this.attr("name")+this.el(b,"value","id","class","checked","require")+">"+this.labelEl(b)},editElement:function(a){return Form.prototype.editEl.call(this,a)},glyphicon:function(a,b){return'<span class="glyphicon '+b+'" data-index="'+a+'" aria-hidden="true"></span>'},deleteItem:function(a){if(!a)throw console.log("Delete item by index:"),a;this.body.items.splice(a,1),this.render()},cloneItem:function(a){if(!a)throw console.log("Clone item by index:"),a;var b=this.body.items[a];this.body.items.splice(a,0,b),this.render()}};var b={html:function(){return this.div()+this.labelAttr()+'\n\t<input name="DynamicModel[input]" '+this.attr("type","value","placeholder","id","class","data","require")+">"+this.helpBlockAttr()+this.divEnd()}},c={html:function(){var a=this.value?this.value:"";return this.div()+this.labelAttr()+"\t<textarea "+this.attr("name","id","class","data","rows","placeholder","require")+">"+a+"</textarea>"+this.helpBlockAttr()+this.divEnd()}},d={html:function(){return this.div()+this.labelAttr()+this.inputs()+this.helpBlockAttr()+this.divEnd()},labelAttr:function(){var a="";return this.body.require&&(a=" *"),this.body.label?"\t<p>"+this.body.label+a+"</p>":""},input:function(a){return'\n\t<div class="radio"><label>'+this.inputHtml("radio",a)+"<label></div>"}},e={html:function(){return this.div()+this.labelAttr()+this.inputs()+this.helpBlockAttr()+this.divEnd()},input:function(a){return'\n\t<div class="checkbox"><label><input type="checkbox"'+this.nameAttr("multi")+this.el(a,"value","id","class","checked","require")+">"+this.labelEl(a)+"<label></div>"}},f={html:function(){return this.div()+this.labelAttr()+"\n\t<select "+this.attr("id","class","name","require")+">"+this.inputs()+"\n\t</select>"+this.helpBlockAttr()+this.divEnd()},input:function(a){return"\n\t\t<option "+this.el(a,"value","selected")+">"+this.labelEl(a)+"</option>"}},g={classAttr:function(){return this.body.class?" "+this.body.class:""},div:function(){return"<div "+this.idAttr()+' class="form-group '+this.body.width+this.classAttr()+'">'},html:function(){return this.div()+this.is(this.body.description)+this.divEnd()}},h={html:function(){return this.div()+'\t<button type="submit" class="btn btn-default">'+this.is(this.body.label)+"</button>"+this.divEnd()}};return{factory:a,input:b,textarea:c,radio:d,checkbox:e,select:f,description:g,submit:h}}();
